<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>A location-based game to rediscover your city</title>              
	
		<!-- Leafet CSS -->

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
        integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
        crossorigin=""/>

        <!--Leaflet js -->    
        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>

        <!-- Turf js -->
		<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script> 
        
        <!-- leaflet sidebar  -->
        <link rel="stylesheet"  href="../static/leaflet-sidebar-master/L.Control.Sidebar.css"  /> <!-- Leaflet sidebar  V1 CSS -->        
        <script src="../static/leaflet-sidebar-master/L.Control.Sidebar.js"></script> <!-- Leaflet sidebar V1 js -->     
        <!-- leaflet legend  -->
        <link rel="stylesheet"  href="../static/Leaflet.Legend-master/leaflet.legend.css"  /> <!-- Leaflet legend CSS -->      
        <script src="../static/Leaflet.Legend-master/leaflet.legend.js"></script> <!-- Leaflet legend js -->    
    
		<!-- leaflet search  -->
		<link rel="stylesheet" href="../static/leaflet-search-master/leaflet-search.css" /> <!-- ADDED -->
		<link rel="stylesheet" href="../static/leaflet-search-master/style.css" /> <!-- ADDED -->
        <script src="../static/leaflet-search-master/leaflet-search.js"></script> <!-- ADDED -->
        
        <!-- Ajax font-awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <!-- To delete markers -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        <!-- Set size to fit mobile browser -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		
           
		<style>
			 /* set the size web page to full size */
			html, body {
				padding:0;
				margin: 0;
				width: 100%;
				height: 100%;
			}
			/* set the size of the map */
			#map {
				width: 100%;
				height: 85%;
			}

            #open_slidebar {
				background-image: url("../static/pics/menuBlack.png"); 
				border: none; 
				height: 33px;
				width: 35px; 
				margin-top: 37px;
				margin-right: 15px;
				position: absolute;
				top: 0;
				right: 0; 
				background-color: #ebebf0; 
			}
			
			.figureborder { 
				border-style: solid; 
				border-color:#898989;
				padding: 2px;
				border-width: thin; 
				background-color: #DCDADA;  
			} 

            /*  NOT SURE I NEED THIS */
			/* Button style */
			button {
				background: #0084ff;
				border: none;
				border-radius: 5px;
				padding: 8px 14px;
				font-size: 15px;
				color: #fff;
			}

			#banner-message.alt {
				background: #0084ff;
				color: #fff;
				margin-top: 40px;
				width: 200px;
			}

			#banner-message.alt button {
				background: #fff;
				color: #000;
			}
            /* for star rating 1*/
            .checked {
            color: orange;
            }
            /* for star rating 2*/
            .rating {
            width: 180px;
            }

            .rating__star {
            cursor: pointer;
            color: #dabd18b2;
            }
		</style>
	</head>


    <!-- Set background colour --> 
    <!--style="background-color: #061529"-->
    <body onload="initMap()", style="background-color: #061529"> 

        <h1 style= 'font-size: 36px; font-family: Arial; color:white; text-align:center; margin-bottom: -10px; margin-left:10px; text-shadow: 1px 1px whitesmoke'> Manc Stories </h1>                          
        
        <!-- A button to switch to the sidebar -->
        <button type= "button" id= "open_slidebar"></button>

        <br>  
        
        <!-- A division to hold the map -->
		<div id='map'></div>

        <!-- Create a sidebar --> 
        <div id="sidebar_settings">
            <h1 style="background-color:white ; color:#061529; text-shadow: 1px 1px white; padding-left:5px;">Invaders discovered:</h1> 				<!-- currently contains miscellaneous stuff --> 
			<p id="score" style="text-align: center;"></p>
			<hr>
            <h1 style="background-color:white ; color:#061529; text-shadow: 1px 1px white; padding-left:5px;">Distance walked:</h1> 				<!-- currently contains miscellaneous stuff --> 
			<p id="dist_tracker" style="text-align: center;"></p>
            <hr>                    
			<h1 style="background-color: white ;text-shadow: 1px 1px #061529; padding-right:5px;"> Gameflow </h1> 
			<p> 1. Walk around central Manchester to discover stories. <br> 2. Touch the 'feet' icon to see how far you are from the nearest story. <br> 3. Once you enter an invisible geofence the hint will popup and the geofence will appear on the map. <br> 4. After listening to the story you are welcome to rate it. <br> 5. Dare to add you own stories to the game. <br> 6. Share your stories with friends!</p> 
			<hr>

		</div>
        

        <!-- Create a star rating-->
        
        <span onmouseover="starmark(this)" onclick="starmark(this)" id="1one" style="font-size:40px;cursor:pointer;" class="fa fa-star checked"></span>
        <span onmouseover="starmark(this)" onclick="starmark(this)" id="2one" style="font-size:40px;cursor:pointer;" class="fa fa-star "></span>
        <span onmouseover="starmark(this)" onclick="starmark(this)" id="3one" style="font-size:40px;cursor:pointer;" class="fa fa-star "></span>
        <span onmouseover="starmark(this)" onclick="starmark(this)" id="4one" style="font-size:40px;cursor:pointer;" class="fa fa-star"></span>
        <span onmouseover="starmark(this)" onclick="starmark(this)" id="5one" style="font-size:40px;cursor:pointer;" class="fa fa-star"></span>
        <br />
        <textarea style="margin-top:1px;" class="form-control" rows="3" id="comment" placeholder="Enter your review"></textarea>

        <button onclick="result()" type="button" style="margin-top:10px;margin-right:5px;" class="btn btn-lg btn-success">Submit</button>
        
        <script>

            // global variable for map
            let map;
            // Set location variable to 'null' to account for no info when user just enters the game
            let position = null; 

            //Counter for score 					
			let geofence_tracker = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];  

            //Counter for score 					
			//let distance_tracker = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]; 

            // initialise empty array for updated coords
            let locationList = []

            // A function to set the flag variable to 'false' for every buffer in enterBuffer_b
            let enterBuffer_b
            let flag_b
            let flag_a

            
            // Variable for arrays of buffers
            let dots, outofBufferB, b_buffers, a_buffers;

            // variables for the arrays of popups
            let b_popups, popup_audio

            // Variable for the square grid
            let cover;

            let geoLine;



            // Style the geofences
            const midStyle = {
                "color": "#2E86C1",
                "weight": 0,
                "fillOpacity": 0.3
            };

            const innerStyle = {
                "color": "#2E86C1", 
                "weight": 0, 
                "fillOpacity":0.3   
            };

            // Style the entered geofences
            const enterstyleIn = { 
                "color": "#0E6655",    // green
                "weight": 3,
                "fillOpacity": 0.6
            };

            const enterstyleMid = { 
                "color": "#2E86C1",   // blue
                "weight": 3,
                "fillOpacity": 0.8
            };






        /**
         * Initialise the map (called when the body has loaded)
         */
        function initMap(){

            

            // Map tiles 
            map = L.map('map');
            const mapCentre = L.latLng(53.4808,-2.2426);
            map.setView(mapCentre,16); //13
            // Change tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
							attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
						}).addTo(map);

            // Sidebar 
            var sidebar_settings = L.control.sidebar('sidebar_settings', {
                position: 'right' 
            }); 
            map.addControl(sidebar_settings);     
        
            document.getElementById("open_slidebar").onclick = Toggle; 
            
            function Toggle () { 
                sidebar_settings.toggle();  
            }

            



            /*
            // TRACK PLAYER'S LOCATION  *************************************************************************************************
            */
            // Leaflet function that tracks player's geolocation
            map.locate({setView: false, maxZoom: 16, watch: true, enableHighAccuracy: true});   // setView to false to make a map more managable


            /*/////////////////////////////////////////////////////////
            //INFO ON BUFFERS AND POPUPS
            *//////////////////////////////////////////////////////////
            //Icon class for custom icons 
            let manIcon = L.Icon.extend({
                options: {
                    iconSize: [37,37],    
                    iconAnchor: [23,37],
                    popupAnchor: [-5, -37] 
                }
            });

            const dot = new manIcon({iconUrl: '../static/pics/dot.png'});
            
            /*
            // SPACE INVADERS  *************************************************************************************************
            */
            // Invader # 1 back_turner
            const dot_1  = turf.point([-2.237332,53.484076]);                                        // Wang Ying store = [53.487068,-2.228138]       
            const a_buff_1 = turf.buffer(dot_1, 0.01, {units:'kilometers',steps:24});              // UoM autolocation = [53.490878,-2.228104]
            const b_buff_1 = turf.buffer(dot_1, 0.05, {units:'kilometers', steps:24});                 
                
            L.geoJSON(a_buff_1,{style: innerStyle}).addTo(map); 
            L.geoJSON(b_buff_1, {style: midStyle}).addTo(map); 										

            const story_1 = L.marker([53.484076,-2.237332], {icon:dot}).bindPopup().addTo(map);
    
            // Buffer 'b' popups
            const b_pop_1_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Back Turner Street invader!</h1><b> Walk to the corner of Back Turner and Back Thomas streets to catch that sneaky creature.</b> <br> <b> Please take a screenshot of the picture below, it will be handy! </b> <iframe src='../static/pics/01_back_turner.jpg' width='300' height='300' frameborder='0' ></iframe>")   //Add content using HTML tags  width='300' height='300'
            const b_pop_1 = story_1.bindPopup(b_pop_1_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            /*
            // Buffer 'b' popups
            const a_pop_1_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Back Turner Street invader!</h1><b> Walk to the corner of Back Turner and Back Thomas streets to catch that sneaky creature.</b> <br> <b> This is how it looks: </b> <iframe src='pics/01_back_turner.jpg' width='300' height='300' frameborder='0' ></iframe>")   //Add content using HTML tags  width='300' height='300'
            const a_pop_1 = story_1.bindPopup(a_pop_1_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            */

            story_1.off('click'); 



            // Invader # 2  02_oak_street
            const dot_2  = turf.point([-2.235480,53.484220]);                           // Christabel = [53.493350,-2.226204]  Rochdale road [53.493023,-2.224488]
            const a_buff_2 = turf.buffer(dot_2, 0.01, {units:'kilometers',steps:24});
            const b_buff_2 = turf.buffer(dot_2, 0.05, {units:'kilometers', steps:24});  
            
            var story_2 = L.marker([53.484220,-2.235480], {icon:dot}).bindPopup().addTo(map);  
            
            L.geoJSON(a_buff_2,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_2, {style: midStyle}).addTo(map); 														 

            // Buffer 'b' popups
            const b_pop_2_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Oak Street invader!</h1><b> Walk to the corner of Oak and Copperas streets to catch that little one!</b> <br> <b>  Please take a screenshot of the picture below, it will be handy! </b> <iframe src='../static/pics/02_oak_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const b_pop_2 = story_2.bindPopup(b_pop_2_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            /*
            // Buffer 'a' popups
            const a_pop_2_info = ("<h1 style ='text-align:center; color: #263985'> Well done. You found Oak Street invader!</h1><br> <iframe src='pics/02_oak_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const a_pop_2 = story_2.bindPopup(a_pop_2_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            */

            story_2.off('click'); 

            
            // Invader # 3  03_tib_street
            const dot_3  = turf.point([-2.235030,53.483652]);                            // St Patric school [53.489761,-2.224294]// ALB  [53.466781,-2.235710]
            const a_buff_3 = turf.buffer(dot_3, 0.01, {units:'kilometers',steps:24});                       // Christabel compound [53.489711,-2.224214]
            const b_buff_3 = turf.buffer(dot_3, 0.05, {units:'kilometers', steps:24});   
    
            var story_3 = L.marker([53.483652,-2.235030], {icon:dot}).bindPopup().addTo(map);   //, {icon:oak}   .addTo(map)
            
            L.geoJSON(a_buff_3,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_3, {style: midStyle}).addTo(map); 										


            // Buffer 'b' popups
            const b_pop_3_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Tib Street invader!</h1><b> Walk to the corner of Tib and Dorsey streets to catch that coloured monster!</b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/03_tib_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const b_pop_3 = story_3.bindPopup(b_pop_3_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            /*
            // Buffer 'a' popups
            const a_pop_3_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Tib Street invader!</h1><b> Walk to the corner of Tib and Dorsey streets to catch that coloured monster!</b><br> <b> This is how it looks: </b><iframe src='pics/03_tib_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const a_pop_3 = story_3.bindPopup(a_pop_3_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            */

            story_3.off('click'); 


            // Invader # 4    04_gay_park
            const dot_4  = turf.point([-2.236600,53.477002]);                           // false uni location [-2.225728,53.467265] // tunnel entrance [-2.229317,53.492024]
            const a_buff_4 = turf.buffer(dot_4, 0.01, {units:'kilometers',steps:24});     // Christabel compound [53.492633,-2.226148]
            const b_buff_4 = turf.buffer(dot_4, 0.05, {units:'kilometers', steps:24});   
   
            var story_4 = L.marker([53.477002,-2.236600], {icon:dot}).bindPopup().addTo(map);   //, {icon:oak}   .addTo(map)
           
            L.geoJSON(a_buff_4,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_4, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_4_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to the gayest invader of them all!</h1><b> Walk along Canal Street until you can see Sackville Garden, he is hiding on the wall! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/04_gay_park.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const b_pop_4 = story_4.bindPopup(b_pop_4_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            /*
            // Buffer 'a' popups
            const a_pop_4_info = ("<h1 style ='text-align:center; color: #263985'> Well done! You found the gayest invader of them all!</h1> <br> <iframe src='pics/12_canal_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const a_pop_4 = story_4.bindPopup(a_pop_4_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });
            */


            story_4.off('click'); 

            // Invader # 5    05_railway_bridge_oxford
            const dot_5  = turf.point([-2.240346,53.473867]);                         
            const a_buff_5 = turf.buffer(dot_5, 0.01, {units:'kilometers',steps:24});     
            const b_buff_5 = turf.buffer(dot_5, 0.05, {units:'kilometers', steps:24});   
   
            var story_5 = L.marker([53.473867,-2.240346], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_5,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_5, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_5_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Oxford Bridge invader!</h1><b> Walk along Oxford Street until you can see the railway bridge, he is hiding on the bridge! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/05_railway_bridge_oxford.jpg' width='300' height='300' frameborder='0' ></iframe>")   //<iframe src='pics/02_oak_street_rs.jpg' width='300' height='300' frameborder='0' ></iframe>
            const b_pop_5 = story_5.bindPopup(b_pop_5_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_5.off('click'); 


            // Invader # 6    06_grosvenor_street
            const dot_6  = turf.point([-2.237087,53.470342]);                          
            const a_buff_6 = turf.buffer(dot_6, 0.01, {units:'kilometers',steps:24});     
            const b_buff_6 = turf.buffer(dot_6, 0.05, {units:'kilometers', steps:24});   
   
            var story_6 = L.marker([53.470342,-2.237087], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_6,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_6, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_6_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Grosvenor Street invader!</h1><b> Walk to the corner of Oxford and Grosvenor streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/06_grosvenor_street.jpg' width='300' height='300' frameborder='0' ></iframe>")   
            const b_pop_6 = story_6.bindPopup(b_pop_6_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_6.off('click'); 


            // Invader # 7    07_umist_campus
            const dot_7  = turf.point([-2.233808,53.475262]);                          
            const a_buff_7 = turf.buffer(dot_7, 0.01, {units:'kilometers',steps:24});     
            const b_buff_7 = turf.buffer(dot_7, 0.05, {units:'kilometers', steps:24});   
   
            var story_7 = L.marker([53.475262,-2.233808], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_7,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_7, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_7_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Umist_Campus invader!</h1><b> Walk to the Umist Campus,he is hiding on corner of railway arch next to Renold Building! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/07_umist_campus.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_7 = story_7.bindPopup(b_pop_7_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_7.off('click'); 


            // Invader # 8    08_dantzic_street
            const dot_8  = turf.point([-2.240295,53.484612]);                          
            const a_buff_8 = turf.buffer(dot_8, 0.01, {units:'kilometers',steps:24});     
            const b_buff_8 = turf.buffer(dot_8, 0.05, {units:'kilometers', steps:24});   
   
            var story_8 = L.marker([53.484612,-2.240295], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_8,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_8, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_8_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Printworks invader!</h1><b> Walk to the corner of Dantzic Street and Withy Grove to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/08_dantzic_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_8 = story_8.bindPopup(b_pop_8_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_8.off('click'); 


            // Invader # 12    12_canal_street
            const dot_12  = turf.point([-2.238385,53.476159]);                          
            const a_buff_12 = turf.buffer(dot_12, 0.01, {units:'kilometers',steps:24});     
            const b_buff_12 = turf.buffer(dot_12, 0.05, {units:'kilometers', steps:24});   
   
            var story_12 = L.marker([53.476159,-2.238385], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_12,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_12, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_12_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to the gayest invader of them all! </h1><b> Walk to the corner of Canal and Princess streets, he is hiding on the bridge! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/12_canal_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_12 = story_12.bindPopup(b_pop_12_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_12.off('click'); 


            // Invader # 13    13_short_street
            const dot_13  = turf.point([-2.236577,53.482467]);                          
            const a_buff_13 = turf.buffer(dot_13, 0.01, {units:'kilometers',steps:24});     
            const b_buff_13 = turf.buffer(dot_13, 0.05, {units:'kilometers', steps:24});   
   
            var story_13 = L.marker([53.482467,-2.236577], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_13,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_13, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_13_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Short Street invader!</h1><b> Walk along Short Street to catch that coloured monster! He is tangled in wires! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/13_short_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_13 = story_13.bindPopup(b_pop_13_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_13.off('click');  


            // Invader # 14    14_china_lane
            const dot_14  = turf.point([-2.233309,53.480546]);                          
            const a_buff_14 = turf.buffer(dot_14, 0.01, {units:'kilometers',steps:24});     
            const b_buff_14 = turf.buffer(dot_14, 0.05, {units:'kilometers', steps:24});   
   
            var story_14 = L.marker([53.480546,-2.233309], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_14,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_14, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_14_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to the Chinese invader!</h1><b> Walk to the corner of China Lane and Back Piccadilly Street to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/14_china_lane.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_14 = story_14.bindPopup(b_pop_14_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_14.off('click');  

            // Invader # 15    15_mosley_street
            const dot_15  = turf.point([-2.242409,53.478991]);                          
            const a_buff_15 = turf.buffer(dot_15, 0.01, {units:'kilometers',steps:24});     
            const b_buff_15 = turf.buffer(dot_15, 0.05, {units:'kilometers', steps:24});   
   
            var story_15 = L.marker([53.478991,-2.242409], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_15,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_15, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_15_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Mosley Street invader!</h1><b> Walk to the corner of Mosley and Princess streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/15_mosley_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_15 = story_15.bindPopup(b_pop_15_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_15.off('click');  


            // Invader # 17    17_bridgewater_place
            const dot_17  = turf.point([-2.237543,53.482311]);                          
            const a_buff_17 = turf.buffer(dot_17, 0.01, {units:'kilometers',steps:24});     
            const b_buff_17 = turf.buffer(dot_17, 0.05, {units:'kilometers', steps:24});   
   
            var story_17 = L.marker([53.482311,-2.237543], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_17,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_17, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_17_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Bridgewater Place invader!</h1><b> Walk to the corner of Bridgewater Place and Tib streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/17_bridgewater_place.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_17 = story_17.bindPopup(b_pop_17_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_17.off('click');


            // Invader # 18    18_balloon_street
            const dot_18  = turf.point([-2.239560,53.485876]);                          
            const a_buff_18 = turf.buffer(dot_18, 0.01, {units:'kilometers',steps:24});     
            const b_buff_18 = turf.buffer(dot_18, 0.05, {units:'kilometers', steps:24});   
   
            var story_18 = L.marker([53.485876,-2.239560], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_18,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_18, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_18_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Balloon Street invader!</h1><b> Walk to the corner of Balloon and Dantzic streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/18_balloon_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_18 = story_18.bindPopup(b_pop_18_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_18.off('click');


            // Invader # 19    19_catlow_lane
            const dot_19  = turf.point([-2.237607,53.483486]);                          
            const a_buff_19 = turf.buffer(dot_19, 0.01, {units:'kilometers',steps:24});     
            const b_buff_19 = turf.buffer(dot_19, 0.05, {units:'kilometers', steps:24});   
   
            var story_19 = L.marker([53.483486,-2.237607], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_19,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_19, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_19_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Catlow Lane invader!</h1><b> Walk to the corner of Catlow Lane and Union Street to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/19_catlow_lane.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_19 = story_19.bindPopup(b_pop_19_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_19.off('click');


            // Invader # 20    20_dale_street
            const dot_20  = turf.point([-2.231990,53.479897]);                          
            const a_buff_20 = turf.buffer(dot_20, 0.01, {units:'kilometers',steps:24});     
            const b_buff_20 = turf.buffer(dot_20, 0.05, {units:'kilometers', steps:24});   
   
            var story_20 = L.marker([53.479897,-2.231990], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_20,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_20, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_20_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Dale Street invader!</h1><b> Walk along Dale Street untill you see the entrance to piccadilly basin. He is hiding on the arch! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/20_dale_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_20 = story_20.bindPopup(b_pop_20_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_20.off('click');

            // Invader # 23    23_hart_street
            const dot_23  = turf.point([-2.238815,53.476874]);                          
            const a_buff_23 = turf.buffer(dot_23, 0.01, {units:'kilometers',steps:24});     
            const b_buff_23 = turf.buffer(dot_23, 0.05, {units:'kilometers', steps:24});   
   
            var story_23 = L.marker([53.476874,-2.238815], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_23,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_23, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_23_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Hart Street invader!</h1><b> Walk to the corner of Hart and Abingdon streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/23_hart_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_23 = story_23.bindPopup(b_pop_23_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_23.off('click');

            // Invader # 24    24_princess
            const dot_24  = turf.point([-2.240388,53.477529]);                          
            const a_buff_24 = turf.buffer(dot_24, 0.01, {units:'kilometers',steps:24});     
            const b_buff_24 = turf.buffer(dot_24, 0.05, {units:'kilometers', steps:24});   
   
            var story_24 = L.marker([53.477529,-2.240388], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_24,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_24, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_24_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Princess invader!</h1><b> Walk to the corner of Princess and Portland streets to catch that coloured monster! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/24_princess.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_24 = story_24.bindPopup(b_pop_24_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_24.off('click');

            // Invader # 25    25_new_wakefield_street
            const dot_25  = turf.point([-2.240817,53.473717]);                          
            const a_buff_25 = turf.buffer(dot_25, 0.01, {units:'kilometers',steps:24});     
            const b_buff_25 = turf.buffer(dot_25, 0.05, {units:'kilometers', steps:24});   
   
            var story_25 = L.marker([53.473717,-2.240817], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_25,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_25, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_25_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Wakefield Street invader!</h1><b> Walk along New Wakefield Street. He is hiding on a side of railway arch. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/25_new_wakefield_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_25 = story_25.bindPopup(b_pop_25_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_25.off('click');

            // Invader # 27    27_castle_street
            const dot_27  = turf.point([-2.253031,53.474461]);                          
            const a_buff_27 = turf.buffer(dot_27, 0.01, {units:'kilometers',steps:24});     
            const b_buff_27 = turf.buffer(dot_27, 0.05, {units:'kilometers', steps:24});   
   
            var story_27 = L.marker([53.474461,-2.253031], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_27,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_27, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_27_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Castle Street invader!</h1><b> Walk along Castle Street. He is hiding on the railway arch! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/27_castle_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_27 = story_27.bindPopup(b_pop_27_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_27.off('click');

            // Invader # 28    28_hewitt_street
            const dot_28  = turf.point([-2.251388,53.474033]);                          
            const a_buff_28 = turf.buffer(dot_28, 0.01, {units:'kilometers',steps:24});     
            const b_buff_28 = turf.buffer(dot_28, 0.05, {units:'kilometers', steps:24});   
   
            var story_28 = L.marker([53.474033,-2.251388], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_28,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_28, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_28_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Hewitt Street invader!</h1><b> Walk to the corner of Hewitt and Deansgate streets. He is hiding on the railway arch! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/28_hewitt_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_28 = story_28.bindPopup(b_pop_28_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_28.off('click');

            // Invader # 29    29_albion_street
            const dot_29  = turf.point([-2.247835,53.473985]);                          
            const a_buff_29 = turf.buffer(dot_29, 0.01, {units:'kilometers',steps:24});     
            const b_buff_29 = turf.buffer(dot_29, 0.05, {units:'kilometers', steps:24});   
   
            var story_29 = L.marker([53.473985,-2.247835], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_29,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_29, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_29_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Albion invader!</h1><b> Walk to the corner of Whitworth and Albion streets. He is hiding on the railway arch! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/29_albion_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_29 = story_29.bindPopup(b_pop_29_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_29.off('click');
            
            
            // Invader # 32    32_college_land
            const dot_32  = turf.point([-2.247762,53.482838]);                          
            const a_buff_32 = turf.buffer(dot_32, 0.01, {units:'kilometers',steps:24});     
            const b_buff_32 = turf.buffer(dot_32, 0.05, {units:'kilometers', steps:24});   
   
            var story_32 = L.marker([53.482838,-2.247762], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_32,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_32, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_32_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to College Land invader!</h1><b> Walk to the corner of College Land and Back College Land streets. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/32_college_land.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_32 = story_32.bindPopup(b_pop_32_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_32.off('click');


            // Invader # 33    33_newton_street
            const dot_33  = turf.point([-2.233850,53.481028]);                          
            const a_buff_33 = turf.buffer(dot_33, 0.01, {units:'kilometers',steps:24});     
            const b_buff_33 = turf.buffer(dot_33, 0.05, {units:'kilometers', steps:24});   
   
            var story_33 = L.marker([53.481028,-2.233850], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_33,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_33, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_33_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Newton invader!</h1><b> Walk to the corner of Newton and Back Piccadilly streets. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/33_newton_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_33 = story_33.bindPopup(b_pop_33_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_33.off('click');


            // Invader # 39    39_hunts_bank
            const dot_39  = turf.point([-2.244486,53.487003]);                          
            const a_buff_39 = turf.buffer(dot_39, 0.01, {units:'kilometers',steps:24});     
            const b_buff_39 = turf.buffer(dot_39, 0.05, {units:'kilometers', steps:24});   
   
            var story_39 = L.marker([53.487003,-2.244486], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_39,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_39, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_39_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Hunts Bank invader!</h1><b> Walk to the corner of Hunts Bank and Victoria streets. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/39_hunts_bank.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_39 = story_39.bindPopup(b_pop_39_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_39.off('click');


            // Invader # 40    40_walkers_croft
            const dot_40  = turf.point([-2.242731,53.486770]);                          
            const a_buff_40 = turf.buffer(dot_40, 0.01, {units:'kilometers',steps:24});     
            const b_buff_40 = turf.buffer(dot_40, 0.05, {units:'kilometers', steps:24});   
   
            var story_40 = L.marker([53.486770,-2.242731], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_40,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_40, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_40_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Walkers Croft invader!</h1><b> Walk to the corner of Walkers Croft and Victoria Station Approach. He is hiding on the wall! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/40_walkers_croft.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_40 = story_40.bindPopup(b_pop_40_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_40.off('click');


            // Invader # 41    41_faraday_street
            const dot_41  = turf.point([-2.233595,53.483074]);                          
            const a_buff_41 = turf.buffer(dot_41, 0.01, {units:'kilometers',steps:24});     
            const b_buff_41 = turf.buffer(dot_41, 0.05, {units:'kilometers', steps:24});   
   
            var story_41 = L.marker([53.483074,-2.233595], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_41,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_41, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_41_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Faraday Street invader!</h1><b> Walk to the corner of Faraday and Spear streets. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/41_faraday_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_41 = story_41.bindPopup(b_pop_41_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_41.off('click');


            // Invader # 43    43_whitworth_street
            const dot_43  = turf.point([-2.240504,53.474978]);                          
            const a_buff_43 = turf.buffer(dot_43, 0.01, {units:'kilometers',steps:24});     
            const b_buff_43 = turf.buffer(dot_43, 0.05, {units:'kilometers', steps:24});   
   
            var story_43 = L.marker([53.474978,-2.240504], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_43,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_43, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_43_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to the most important invader of them all!</h1><b> Walk to the corner of Whitworth and Oxford streets. </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/43_whitworth_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_43 = story_43.bindPopup(b_pop_43_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_43.off('click');


            // Invader # 45    45_back_piccadilly
            const dot_45  = turf.point([-2.237163,53.481969]);                          
            const a_buff_45 = turf.buffer(dot_45, 0.01, {units:'kilometers',steps:24});     
            const b_buff_45 = turf.buffer(dot_45, 0.05, {units:'kilometers', steps:24});   
   
            var story_45 = L.marker([53.481969,-2.237163], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_45,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_45, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_45_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Back Piccadilly invader!</h1><b> Walk to the corner of Back Piccadilly and Oldham streets. This one is huge! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/45_back_piccadilly.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_45 = story_45.bindPopup(b_pop_45_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_45.off('click');


            // Invader # 46    46_parsonage_lane
            const dot_46  = turf.point([-2.246820,53.483042]);                          
            const a_buff_46 = turf.buffer(dot_46, 0.01, {units:'kilometers',steps:24});     
            const b_buff_46 = turf.buffer(dot_46, 0.05, {units:'kilometers', steps:24});   
   
            var story_46 = L.marker([53.483042,-2.246820], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_46,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_46, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_46_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Parsonage Lane invader!</h1><b> Walk to the corner of Parsonage Lane and Deansgate Street. This one is huge! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/46_parsonage_lane.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_46 = story_46.bindPopup(b_pop_46_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_46.off('click');


            // Invader # 30    30_pic_gardens
            const dot_30  = turf.point([-2.237221,53.480715]);                          
            const a_buff_30 = turf.buffer(dot_30, 0.01, {units:'kilometers',steps:24});     
            const b_buff_30 = turf.buffer(dot_30, 0.05, {units:'kilometers', steps:24});   
   
            var story_30 = L.marker([53.480715,-2.237221], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_30,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_30, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_30_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Piccadilly Gardens invader!</h1><b> Look under stone banches of Piccadilly Gardens. She is hiding under one of them! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/30_pic_gardens.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_30 = story_30.bindPopup(b_pop_30_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_30.off('click');


            // Invader # 101    Christabel 101
            const dot_101  = turf.point([-2.226024,53.493367]);                          
            const a_buff_101 = turf.buffer(dot_101, 0.01, {units:'kilometers',steps:24});     
            const b_buff_101 = turf.buffer(dot_101, 0.05, {units:'kilometers', steps:24});   
   
            var story_101 = L.marker([53.493367,-2.226024], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_101,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_101, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_101_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Piccadilly Gardens invader!</h1><b> Look under stone banches of Piccadilly Gardens. She is hiding under one of them! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/30_pic_gardens.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_101 = story_101.bindPopup(b_pop_101_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_101.off('click');


            // Invader # 102    Christabel parking
            const dot_102  = turf.point([-2.226228,53.492684]);                          
            const a_buff_102 = turf.buffer(dot_102, 0.01, {units:'kilometers',steps:24});     
            const b_buff_102 = turf.buffer(dot_102, 0.05, {units:'kilometers', steps:24});   
   
            var story_102 = L.marker([53.492684,-2.226228], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_102,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_102, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_102_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to gay invader!</h1><b> Look under stone banches of Christabel. She is hiding under one of them! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='../static/pics/12_canal_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_102 = story_102.bindPopup(b_pop_102_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_102.off('click');

            /*
            // Invader # XX    XXXX
            const dot_XX  = turf.point([XXXX,XXXX]);                          
            const a_buff_XX = turf.buffer(dot_XX, 0.02, {units:'kilometers',steps:24});     
            const b_buff_XX = turf.buffer(dot_XX, 0.05, {units:'kilometers', steps:24});   
   
            var story_XX = L.marker([XXXX,XXXX], {icon:dot}).bindPopup().addTo(map);   
           
            L.geoJSON(a_buff_XX,{style: innerStyle}).addTo(map);
            L.geoJSON(b_buff_XX, {style: midStyle}).addTo(map); 										

            // Buffer 'b' popups
            const b_pop_XX_info = ("<h1 style ='text-align:center; color: #263985'> You are very close to Albion invader!</h1><b> Walk to the corner of Whitworth and Albion streets. He is hiding on the railway arch! </b><br> <b> Please take a screenshot of the picture below, it will be handy! </b><iframe src='pics/29_albion_street.jpg' width='300' height='300' frameborder='0' ></iframe>")  
            const b_pop_XX = story_XX.bindPopup(b_pop_XX_info, { 
                maxWidth: 320,				 
                maxHeight: 400
            });

            story_XX.off('click');
            */













            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Adding audio Popup
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Add a song icon
            const audioIcon = L.icon({
                iconUrl: "../pinkMusic.png",
                iconSize: [50, 58], // size of the icon
                iconAnchor: [20, 58], // changed marker icon position
                popupAnchor: [0, -60], // changed popup position
            });
            

            const customPopup1 =
            //'<iframe width="360" height="310" src="https://www.youtube.com/embed/glKDhBuoRUs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            '<b>Well done! You found Back Turner Invader!</b><br><b>Please listen to a story</b><br><iframe src="static/media/house_of_rising_sun.mp3" width="300" height="60" frameborder="0" ></iframe>';
            // specify popup options
            const customOptions1 = {
            maxWidth: "auto", // set max-width
            className: "customPopup", // name custom popup
            };
            const house_of_rising_sun = L.marker([53.492633,-2.226148], {icon: audioIcon}).bindPopup(customPopup1, customOptions1);
            // create popup contents

            // create popup contents
            const customPopup2 =
            //'<iframe width="360" height="310" src="https://www.youtube.com/embed/glKDhBuoRUs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            '<b>Well done! You found Oak Street Invader!</b><br><b>Please listen to a story</b><br><iframe src="static/media/take_you_dancing_mp3.mp3" width="300" height="60" frameborder="0" ></iframe>';
            // specify popup options
            const customOptions2 = {
            maxWidth: "auto", // set max-width
            className: "customPopup", // name custom popup
            };
            const gotta_let_you_go = L.marker([53.493350,-2.226204], {icon: audioIcon}).bindPopup(customPopup2, customOptions2);

            // create popup contents
            const customPopup3 =
            //'<iframe width="360" height="310" src="https://www.youtube.com/embed/glKDhBuoRUs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            '<b>Well done! You found Tib Street Invader!</b><br><iframe src="static/media/dont_look_back_in_anger.mp3" width="300" height="60" frameborder="0" ></iframe>';
            // specify popup options
            const customOptions3 = {
            maxWidth: "auto", // set max-width
            className: "customPopup", // name custom popup
            };
            const dont_look_back_in_anger = L.marker([53.492234,-2.226117], {icon: audioIcon}).bindPopup(customPopup3, customOptions3);

            // create popup contents
            const customPopup4 =
            //'<iframe width="360" height="310" src="https://www.youtube.com/embed/glKDhBuoRUs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            '<b>Well done! You found Gay Invader!</b><br><iframe src="static/media/house_of_rising_sun.mp3" width="300" height="60" frameborder="0" ></iframe>';
            // specify popup options
            const customOptions4 = {
            maxWidth: "auto", // set max-width
            className: "customPopup", // name custom popup
            };
            const rhinestone_eyes = L.marker([53.492024,-2.229317], {icon: audioIcon}).bindPopup(customPopup4, customOptions4);


            /*
            // Geofences   ///////////////
            */

            // To inform a player if she's not in the geofence     
            // Areas outside of the largest buffers  
            outofBufferB = [b_buff_1, b_buff_2, b_buff_3, b_buff_4,b_buff_5, b_buff_6, b_buff_7, b_buff_8,b_buff_12, b_buff_13, b_buff_14, b_buff_15,b_buff_17, b_buff_18, b_buff_19, b_buff_20,b_buff_23, b_buff_24, b_buff_25, b_buff_27,b_buff_28, b_buff_29, b_buff_32, b_buff_33,b_buff_39, b_buff_40, b_buff_41, b_buff_43,b_buff_45, b_buff_46, b_buff_30, b_buff_101,b_buff_102];
            // Points in the centre of each buffer
            dots = turf.featureCollection([dot_1, dot_2, dot_3, dot_4,dot_5, dot_6, dot_7, dot_8,dot_12, dot_13, dot_14, dot_15,dot_17, dot_18, dot_19, dot_20,dot_23, dot_24, dot_25, dot_27,dot_28, dot_29, dot_32, dot_33,dot_39, dot_40, dot_41, dot_43,dot_45, dot_46, dot_30, dot_101,dot_102]);

            // OUTER buffers list (larger buffers)
            b_buffers = [b_buff_1, b_buff_2, b_buff_3, b_buff_4,b_buff_5, b_buff_6, b_buff_7, b_buff_8,b_buff_12, b_buff_13, b_buff_14, b_buff_15,b_buff_17, b_buff_18, b_buff_19, b_buff_20,b_buff_23, b_buff_24, b_buff_25, b_buff_27,b_buff_28, b_buff_29, b_buff_32, b_buff_33,b_buff_39, b_buff_40, b_buff_41, b_buff_43,b_buff_45, b_buff_46, b_buff_30, b_buff_101,b_buff_102];   
            // OUTER buffers' popups
            b_popups = [b_pop_1, b_pop_2, b_pop_3, b_pop_4,b_pop_5, b_pop_6, b_pop_7, b_pop_8,b_pop_12, b_pop_13, b_pop_14, b_pop_15,b_pop_17, b_pop_18, b_pop_19, b_pop_20,b_pop_23, b_pop_24, b_pop_25, b_pop_27,b_pop_28, b_pop_29, b_pop_32, b_pop_33,b_pop_39, b_pop_40, b_pop_41, b_pop_43,b_pop_45, b_pop_46, b_pop_30, b_pop_101,b_pop_102]; 
            // INNER buffers' popups
            // a_popups = [a_pop_1, a_pop_2, a_pop_3, a_pop_4]; 

            // INNER buffers list (smaller buffers) 
            a_buffers = [a_buff_1,a_buff_2, a_buff_3, a_buff_4,a_buff_5,a_buff_6, a_buff_7, a_buff_8,a_buff_12,a_buff_13, a_buff_14, a_buff_15,a_buff_17,a_buff_18, a_buff_19, a_buff_20,a_buff_23,a_buff_24, a_buff_25, a_buff_27,a_buff_28,a_buff_29, a_buff_32, a_buff_33,a_buff_39,a_buff_40, a_buff_41, a_buff_43,a_buff_45,a_buff_46, a_buff_30, a_buff_101,a_buff_102];
            // Audio popups
            popup_audio = [rhinestone_eyes, gotta_let_you_go, dont_look_back_in_anger, house_of_rising_sun, gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,rhinestone_eyes, gotta_let_you_go, dont_look_back_in_anger, house_of_rising_sun, gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,rhinestone_eyes, gotta_let_you_go, dont_look_back_in_anger, house_of_rising_sun, gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun,house_of_rising_sun,gotta_let_you_go,house_of_rising_sun] 

            // SQUARE GRID
            // specify units for measurement
            let gridOptions = {units: 'kilometers'};
            // get grid as a turf polygon 
            let grid = turf.squareGrid([-2.275069,53.456925,-2.204545,53.504266], 0.1, gridOptions);   // Manchester City Centre [-2.257649,53.459561,-2.220493,53.494114]
            // turn grid into geoJson to display on a map
            cover = L.geoJson(grid, {style: {color:'#000000', fill: '#89CFF0', fillOpacity: 0.6, weight: 0.0}}).addTo(map); 



            // A function to set the flag variable to 'false' for every buffer in enterBuffer_b 
            enterBuffer_b = [];
                for (let i=0; i<b_buffers.length; i++){
                    enterBuffer_b.push(false);}

            flag_b = [];
                for (let i=0; i<b_buffers.length; i++){
                    flag_b.push(false);}

            flag_a = [];
                for (let i=0; i<a_buffers.length; i++){
                    flag_a.push(false);}



            // Location error function 
            function onLocationError(e) {         
                alert(e.message); 
            } 
            map.on('locationerror', onLocationError);

            // bind listeners
            map.on('locationfound', onLocationFound);
            map.on('locationerror', onLocationError);

                        /////////////////////////////////////////////////////////////////////////////////////////////////////
            // LEGEND WITH ALL HIDDEN INVADERS
            
            //Legend
            L.control.Legend({           
                    position: "bottomright", 
                    collapsed: true,      
                    legends: [{ 
                        label : "Back Turner Man_1", 
                        type: "image", 
                        url: "../static/pics/man_1_back_turner.jpg",  
                    },{ 
                        label: "Oak Man_2", 
                        type: "image", 
                        url: "../static/pics/man_2_oak.jpg", 
                    },{ 
                        label: "Tib Man_3", 
                        type: "image", 
                        url: "../static/pics/man_3_tib.jpg", 
                    },{ 
                        label: "Canal Man_12", 
                        type: "image", 
                        url: "../static/pics/man_12_canal.jpg",
                    },{ 
                        label: "Oxford Man_5", 
                        type: "image", 
                        url: "../static/pics/man_5.jpg", 
                    },{ 
                        label: "Dantzic Man_8", 
                        type: "image", 
                        url: "../static/pics/man_8.jpg", 
                    },{ 
                        label: "Back Pic. Man_10", 
                        type: "image", 
                        url: "../static/pics/man_10.jpg", 
                    },{ 
                        label: "Short Man_13", 
                        type: "image", 
                        url: "../static/pics/man_13.jpg", 
                    },{ 
                        label: "China Man_14", 
                        type: "image", 
                        url: "../static/pics/man_14.jpg", 
                    },{ 
                        label: "Cooper Man_15", 
                        type: "image", 
                        url: "../static/pics/man_15.jpg", 
                    },{ 
                        label: "Man_16", 
                        type: "image", 
                        url: "../static/pics/man_16.jpg", 
                    },{ 
                        label: "Balloon Man_18", 
                        type: "image", 
                        url: "../static/pics/man_18.jpg", 
                    },{ 
                        label: "Catlow Man_19", 
                        type: "image", 
                        url: "../static/pics/man_19.jpg", 
                    },{ 
                        label: "Dale Man_20", 
                        type: "image", 
                        url: "../static/pics/man_20_dale.jpg", 
                    },{ 
                        label: "Hart Man_23", 
                        type: "image", 
                        url: "../static/pics/man_23.jpg", 
                    },{ 
                        label: "Portland Man_24", 
                        type: "image", 
                        url: "../static/pics/man_24.jpg", 
                    },{ 
                        label: "Castle Man_27", 
                        type: "image", 
                        url: "../static/pics/man_27.jpg", 
                    },{ 
                        label: "Hewitt Man_28", 
                        type: "image", 
                        url: "../static/pics/man_28.jpg", 
                    },{ 
                        label: "Albion Man_29", 
                        type: "image", 
                        url: "../static/pics/man_29.jpg", 
                    },{ 
                        label: "Pic. Gardens Man_30", 
                        type: "image", 
                        url: "../static/pics/man_30_pic_gardens.jpg", 
                    },]
                }).addTo(map);
                //////////////////////////////////////////////////////////////////////////////////////////////////////
        };


            


            /*
            // GEOLOCATION FUNCTION   *************************************************************************************************
            */
            function onLocationFound(e) { 

                /*
                // Player's location   ///////////////
                */

                // use turf to create a turf.Point() object (which is stored as GeoJSON) Create a turf point to be able to interact with the other features 
                player = turf.point([e.latlng.lng, e.latlng.lat]);		 	 
                // Geolocation icon
                const playerIcon = L.icon({     
                    iconUrl: '../static/feet.png',   
                    iconSize: [37,37],    
                    iconAnchor: [17, 37],  
                    popupAnchor: [0,-37],
                })
                // Print the coords to the console. DELETE LATER ON
                console.log("Your current position is at:" +e.latlng);  
                // This accounts for the geolocation when the user just opens the game
                if (position == null) {                        
                    position = L.marker(e.latlng, {icon:playerIcon}).addTo(map);
                // Update the geolocation when the current location is known
                } else { 
                    position.setLatLng(e.latlng); 
                }

                // Push the person's location to the array
                locationList.push([e.latlng.lng, e.latlng.lat]);  // [e.latlng.lng, e.latlng.lat]
                console.log(locationList);

                // Create a lineString
                let myLine = turf.lineString(locationList, {name:"user track"});   // Array.from(coordsArray) // Uncaught Error: coordinates must be an array of two or more positions
                // let myLineJson = L.geoJson(myLine);
                // Simplify the line using a turf function 
                const options = {tolerance: 0.000001, highQuality: false}; //0.000833
                let simplified = turf.simplify(myLine, options);

                // calculate the length of the user track
                playerPath = turf.lineDistance(simplified, 'kilometers');   //length(simplified);
                console.log(playerPath);
                document.getElementById("dist_tracker").innerHTML = playerPath;



                // Remove the privious layer every time the location updates
                if (geoLine) {
                    geoLine.remove();
                    };
                // add a Json line to the map
                geoLine = L.geoJson(simplified, {style: {       // simplified
                                                weight: 1,
                                                color: 'red',
                                                fillOpacity: 1,
                                                fillColor: 'lightgrey',
                                            }}).addTo(map);

                /*                            
                // Function to connect coords every 50 meters
                for (i=0; i<locationList.length; i++){
                let myLine = turf.lineString([locationList[0], locationList[i]], {name:"user track"});
                
                let geoLine = L.geoJson(myLine, {style: {
                                                weight: 0.5,
                                                color: 'red',
                                                fillOpacity: 1,
                                                fillColor: 'lightgrey',
                                            }}).addTo(map);                // {type: "Point", coordinates: [13.42493130000003, 52.50074619999999 ]}
                console.log(geoLine)
                const options = {tolerance: 0.000833, highQuality: false}; 
                let simplified = turf.simplify(geoLine, options).addTo(map);     // Uncaught Error: unknown GeoJSON type
                };
                */
                
                



                // calculate the nearest point
                var nearest = turf.nearestPoint(player, dots);
                
                // For loop to assess if current location is outside the buffers and if yes add a popup notifying the user about the time to the target
                for ( let i=0; i<outofBufferB.length; i++) {
                    inside = turf.booleanWithin(player, outofBufferB[i],)
                    if (inside === false) { 
                        let distance = Math.round(turf.distance(player,nearest,{units:'kilometers'})*1000)/1000;  //var
                        // 5 km/hr is an average speed of a person
                        let time_dist =  Math.round(60*distance)/5;             
						position.bindPopup("<h1 style ='text-align:center; color: #061529'>Yes! There are space invaders hiding here!</h1> <b>The nearest invader is about: " + time_dist.toString()+" minutes away!</b>", {maxWidth: 200});
                        }
                    else {
                        position.bindPopup("<strong>You very close.</strong><br />Keep exploring!.<br> <b> Walking towards the centre of the circle would help. </b>", {maxWidth: 500});
                    }
                }
                // Calculate nearest point function info
                // https://stackoverflow.com/questions/56306097/get-nearest-point-from-another-one-in-javascript
                // nearest point info
                // https://www.npmjs.com/package/@turf/nearest-point
           

                // BUFFER B
                for (let i=0; i<b_buffers.length; i++){
                    
                    // TESTING: add to the map (and remove previous one to avoid accumulation)
                    geoJSON = L.geoJSON(b_buffers[i]).addTo(map);
                    if (geoJSON) map.removeLayer(geoJSON);
                    

                    // are we in the geofence?
                    const currentlyWithin_b = turf.booleanWithin(player, b_buffers[i]);


                    // if we were NOT within the buffer at the last location
                    if (!flag_b[i]) {

                        // enter the geofence
                        if (currentlyWithin_b){
                        
                            // Open a popup
                            b_popups[i].openPopup();
                            // create marker object
                            L.geoJSON(b_buffers[i], {style: enterstyleMid}).addTo(map);
                            
                            // update the flag
                            flag_b[i] = true;
                        
                        // still outside the geofence
                        }; 

                    // if we WERE within the buffer at the last location
                    } else {

                        // update the flag
                        flag_b[i] = currentlyWithin_b;
                    }
                    

                };


                // BUFFER A
                for (let i=0; i<a_buffers.length; i++){
                    
                    // TESTING: add to the map (and remove previous one to avoid accumulation)
                    geoJSON = L.geoJSON(a_buffers[i]).addTo(map);
                    if (geoJSON) map.removeLayer(geoJSON);
                    

                    // are we in the geofence?
                    const currentlyWithin_a = turf.booleanWithin(player, a_buffers[i]);

                    // if we were NOT within the buffer at the last location
                    if (!flag_a[i]) {

                        // enter the geofence
                        if (currentlyWithin_a){

                            /* do something here (popups etc...) */
                            // a_popups[i].openPopup();
                            // create marker object
                            L.geoJSON(a_buffers[i], {style: enterstyleIn}).addTo(map);
                            // update the flag
                            flag_a[i] = true;
                        
                        // still outside the geofence
                        }; 

                    // if we WERE within the buffer at the last location
                    } else {

                        // update the flag
                        flag_a[i] = currentlyWithin_a;
                    }

                };

                for ( let i = 0; i < a_buffers.length; i++) {       
                    if (turf.booleanWithin(player, a_buffers[i])) {					
                        popup_audio[i].addTo(map);   // .openPopup()
                        if (geofence_tracker [i] == 0) {
                            geofence_tracker[i] =1;
                            points = 0;
                            for(let j in geofence_tracker) {points += geofence_tracker[j]};
                            document.getElementById("score").innerHTML = points;
                            };		
						};	
                    };

                
                
                /*/////////////////////////////////////////////////////////////////////////////////////////////////////
                // SQUARE GRID
                */////////////////////////////////////////////////////////////////////////////////////////////////////

                
                // Loop through each grid square
                cover.eachLayer(function(layer){

                    // Get grid as a turf polygon
                    let poly = turf.polygon(layer.feature.geometry.coordinates);

                    // Check if avatar intersects with grid
                    let ptIntersect = turf.booleanPointInPolygon(player, poly);

                    // Get bounds of the grid and zoom to it
                    if(ptIntersect === true){
                        
                        // Update the layer to ensure that only squares where the player is located are see-through
                        layer.setStyle({fillOpacity: 0})
                        
                    }

                });

            };











            





            /*/////////////////////////////////////////////////////////////////////////////////////////////////////
            // STAR RATING FUNCTION
            *///////////////////////////////////////////////////////////////////////////////////////////////////////
                var count;

                function starmark(item) {
                count = item.id[0];
                sessionStorage.starRating = count;
                var subid = item.id.substring(1);
                for (var i = 0; i < 5; i++) {
                    if (i < count) {
                    document.getElementById(i + 1 + subid).style.color = "orange";
                    } else {
                    document.getElementById(i + 1 + subid).style.color = "black";
                    }
                }
                }

                function result() {
                //Rating : Count
                //Review : Comment(id)
                alert(
                    "Rating : " +
                    count +
                    "\nReview : " +
                    document.getElementById("comment").value
                );
                }
                





        </script>
    </body>
</html>